---
name: debug-fix
description: 不具合の再現、原因切り分け、最小修正の進め方を提供する。ユーザーがデバッグ、原因特定、ログ解析、再現手順の整理を求める場合に使用する（単純な表記修正のみは対象外）。
metadata:
  short-description: デバッグと修正
---

# Debug Fix

不具合を再現し、原因を特定し、最小の修正で解決する。

## 目的

- 事象の再現と切り分けを最優先にする。
- 影響範囲を抑え、最小変更で修正する。
- 再発防止のための検証を行う。

## 対象外

- 表記修正など、再現や調査を必要としない軽微な変更。

## レビュー・改善サイクル（必須）

- 生成・修正する内容（計画、手順、文面、設定、変更案など）は、提示または適用前にレビューする。
- レビュー結果を反映して改善し、これを3回繰り返す。
- 3回目の改善結果を最終案として採用する。
- ユーザー指定や既存規約がある場合は、それらを優先して最終案に反映する。

## 前提確認

- 何が起きているか（症状）を確認する。
- いつから起きているかを確認する。
- 再現手順と期待結果を確認する。
- 影響範囲（ユーザー・機能・環境）を確認する。
- 既知の制約や運用ルールを確認する。
- 環境情報（OS、バージョン、依存関係、設定）を確認する。
- 不明点は最小限の質問で補う。

## 事実と仮説の分離

- 観測ログ、再現結果、スタックトレースなどの事実を先に整理する。
- 原因候補は仮説として扱い、検証結果で更新する。
- 断定できない内容は「未確定」と明示する。

## 影響度の把握

- 影響の大きさ（ユーザー数、機能範囲、頻度）を把握する。
- 緊急度に応じて優先順位を付ける。

## 調査の進め方

### 1) 再現

- 再現手順を確立する。
- 再現頻度と条件を整理する。
- 再現が難しい場合はログ・メトリクス・入力を集める。
- 再現材料（入力、タイムスタンプ、環境情報）を保全する。

### 2) 切り分け

- 変更点・依存関係・入力の差分に着目する。
- 影響範囲を絞り、最小の再現ケースにする。
- 仮説を立てて検証する。
- 仮説ごとに「検証手順/結果/判定」を記録する。

### 3) 原因特定

- 原因候補を優先度順に並べる。
- ログ、スタックトレース、検証結果で絞り込む。
- 1つの仮説に対して1つの検証を行う。
- 反証された仮説は除外理由を残して破棄する。

### 4) 修正方針

- 最小変更で直る方針を優先する。
- 既存挙動の破壊を避ける。
- 影響範囲が広い場合は段階的に修正する。

### 5) 検証

- 失敗ケース・境界条件を含めて再確認する。
- 既存テストがあれば優先して実行する。
- テストが実行できない場合は理由と代替検証を示す。
- 修正で再発しうる周辺機能のスモーク確認を含める。

## 調査終了条件

- 根本原因の説明が観測事実と矛盾しない。
- 修正後に再現手順で問題が再発しない。
- 未検証項目がある場合は、残課題として明示されている。

## 出力フォーマット

```markdown
# デバッグ結果: [問題名]

## 症状

- [観測された症状]

## 事実と仮説

- 事実:
- 仮説:

## 再現手順

- [手順]

## 影響度

- [影響・緊急度]

## 原因

- [根本原因]

## 修正方針

- [最小修正の方針]

## 変更点

- [ファイル・機能]

## 検証

- 実施したテスト:
- 代替検証:
- 未検証項目:

## リスク

- [リスク]
  - 対応: [対策]
```

## 返答のガイド

- 事実（観測結果）と推測（仮説）を分けて書く。
- 再現条件と根本原因を簡潔に説明する。
- 最小修正の方針と影響範囲を明記する。
- 実施した検証と未検証を明確にする。
- 追加の確認事項があれば短く質問する。
- 原因断定が難しい場合は、次の検証計画を示して保留理由を明記する。
