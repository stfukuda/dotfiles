---
name: git-push
description: Gitでローカルコミットをリモートへプッシュする手順を提供する。ユーザーがプッシュ、upstream設定、タグのプッシュを求める場合に使用する（強制プッシュは明示指示が必要）。
metadata:
  short-description: Git push
---

# Git Push

## 概要

現在のブランチのローカルコミットをリモートへプッシュし、必要ならupstreamを設定する。タグのプッシュは明示要求がある場合のみ行う。失敗や曖昧な指示は止めて確認する。
プッシュは安全性を優先し、明示されたリモート・ブランチがあればそれに従う。

## 手順

### 1) 状況確認

- 現在のブランチとupstreamの有無を確認:
  - `git status -sb`
  - `git branch -vv`
- リモート一覧を確認:
  - `git remote -v`
- `origin` が存在しない、または複数リモートがある場合は、プッシュ先を確認し、確認が取れるまで停止する。
- detached HEADなら止めて、どのブランチへプッシュするか確認する。
- rebase・merge・cherry-pick・revert 中やコンフリクトがある場合は止めて確認する。
- 未コミットの変更はプッシュ対象外である旨を必要に応じて伝える。

### 2) プッシュ対象の判定

- `git status -sb` で ahead が 0 かつタグのプッシュ指示がない場合は「プッシュ対象がない」旨を伝えて終了する。
- ahead が 0 でもタグのプッシュ指示がある場合は、タグのみ実行する。
- タグのみ実行の場合は、ブランチのプッシュ（手順4）を省略して手順5へ進む。
- behind または diverged と表示された場合は、プル・リベースの要否を確認し、指示があるまでプッシュは中止する。
- upstream が設定されているが、現在のブランチ名と一致しない場合は確認する。

### 3) プッシュ先の決定

- 既定リモートは `origin`（ユーザー指定があればそれを優先）。
- ブランチは現在のブランチ（ユーザー指定があればそれを優先）。
- upstream未設定なら `-u` を使う。
- ユーザーがリモート名やブランチ名を明示した場合は、常に明示指定を優先し `git push <remote> <branch>` 形式で実行する。
- ユーザー指定がない場合は、`origin` が存在し単一リモートのときに限り `<remote>` を `origin` として扱う。
- upstream が既にあり、明示指定と異なる場合は実行前に確認する。

### 4) プッシュ実行（強制は使わない）

- upstreamが未設定なら:
  - `git push -u <remote> <branch>`
- upstreamが既にある & 明示指定がないなら:
  - `git push`
- upstreamが既にあるが明示指定があるなら:
  - `git push <remote> <branch>`

### 5) タグのプッシュ（明示指示がある場合のみ）

- すべてのタグをプッシュ:
  - タグ数が多い場合は確認する。
  - リモート指定がある場合: `git push <remote> --tags`
  - リモート指定がない場合: `git push --tags`
- 特定タグのみプッシュ:
  - タグが存在しない場合は止めて確認する。
  - `git push <remote> <tag>`

### 6) 強制プッシュ（明示指示がある場合のみ）

- 実行前に必ず確認を取る。
- 可能なら `--force-with-lease` を優先し、ユーザーが `--force` を明示した場合のみ `--force` を使う。

### 7) 失敗時の扱い

- 認証エラー、non-fast-forward、保護ブランチなどのエラーは止めてユーザーに確認する。
- 自動で解決策を実行しない（ユーザーの指示があれば対応）。

## 例

- 「プッシュ」
  - 現在のブランチを `origin` にプッシュ。upstream未設定なら `-u` を使う。
- 「今のコミットをプッシュして」
  - 上と同様。
- 「タグもプッシュして」
  - ブランチをプッシュ後にタグをプッシュ。
- 「タグだけプッシュして」
  - ブランチはプッシュせず、タグのみプッシュ。
- 「強制でプッシュして（force）」
  - 確認後、原則 `--force-with-lease`（明示なら `--force`）。

## 返答のガイド

- どのリモート・ブランチへプッシュしたかを簡潔に報告する。
- upstream を設定した場合はその旨を明記する。
- タグをプッシュした場合はタグの種類（全タグ・特定タグ）を明記する。
- 強制プッシュを実行した場合は方法（`--force-with-lease` か `--force`）を明記する。
