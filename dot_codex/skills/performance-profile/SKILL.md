---
name: performance-profile
description: 性能計測・ベンチマーク・プロファイリングの計画と実施手順を提供する。ユーザーが計測準備、回帰判定、改善効果の確認を求める場合に使用する。
metadata:
  short-description: 性能計測
---

# Performance Profile

性能計測を再現可能に行い、回帰を正しく判断する。

## 目的

- 計測条件を統一し再現性を確保する。
- ボトルネックの特定と改善効果の確認を行う。
- 回帰判定の基準を明確にする。

## 対象外

- 軽微な変更で計測が不要だと明示されている場合。

## 前提確認

- 対象の計測目的（速度・メモリ・CPU・I/O・起動時間など）を確認する。
- 対象環境（OS・CPU・メモリ・ストレージ・ネットワーク）を確認する。
- 計測ツールや既存の手順があれば優先する。
- 既存の基準値（baseline）があるか確認する。
- 計測対象の代表性（実運用に近い入力や負荷）を確認する。
- 不明点は最小限の質問で補う。

## 回帰判定ルール

- baseline がある場合は、同一条件での差分率を主指標にする。
- baseline がない場合は、初回計測結果を暫定baselineとして記録し、次回比較可能な形で保存する。
- 判定は単一値ではなく統計値（中央値/p95）で行う。
- 許容閾値が未合意なら、暫定閾値を提案して合意後に最終判定する。

## 手順

### 1) 計測条件の固定

- 計測対象・入力・データ量を固定する。
- ウォームアップ・キャッシュ条件を揃える。
- 計測回数と統計値（平均・中央値・p95など）を決める。
- 外部要因（バックグラウンド処理・ネットワーク変動）を抑える。

### 2) 計測の実行

- 既定の方法で計測を行う。
- 実行コマンド・フラグ・環境変数を記録する。
- 計測結果とログを保存する。
- 計測失敗時は条件とエラーログを残す。
- ノイズが大きい場合は計測回数を増やし、外れ値の扱いを明示する。

### 3) 分析

- 主要指標（例: レイテンシ、スループット、メモリ）を整理する。
- 変動が大きい場合は要因を分離する。
- ボトルネック候補を挙げる。
- 影響の大きい差分から優先的に扱う。
- 計測条件差が疑われる場合は判定を保留し、再計測条件を提示する。

### 4) 回帰判定

- 事前に合意した基準と比較する。
- 差が小さい場合は誤差範囲として扱う。
- 回帰が疑われる場合は再計測で確認する。
- 基準がない場合は暫定基準を提案する。

### 5) 改善後の再計測

- 同一条件で再計測し、改善効果を比較する。
- 効果が小さい場合は誤差範囲か実改善かを明示する。

## 計測品質チェックリスト

- [ ] baseline と current の計測条件が一致している
- [ ] 実行コマンド・フラグ・環境変数を記録している
- [ ] 計測回数と統計値（中央値/p95等）を明記している
- [ ] 判定基準と結果が対応している
- [ ] 判定不能の場合に保留理由と次アクションを示している

## 避けるべきこと

- 条件が揃っていない計測の比較。
- 計測回数が少なく結論を出す。
- 結果の断定のみで根拠がない。
- 基準なしで回帰判定を出す。

## 出力フォーマット

```markdown
# 性能計測: [対象]

## 目的

- 計測対象:
- 指標:

## 環境

- OS/CPU/メモリ:
- ストレージ/ネットワーク:

## 条件

- 入力/データ量:
- 計測回数:
- 統計値:
- ウォームアップ:
- 外部要因対策:

## 実行

- コマンド:
- フラグ/環境変数:

## 結果

- baseline:
- current:
- 差分:
- 信頼性:
- 判定の前提:

## 回帰判定

- 基準:
- 判定:
- 追加計測:
- 保留理由:
```

## 返答のガイド

- 先に計測条件と環境を明示する。
- 回帰判定は基準とセットで書く。
- 不明点があれば短く確認する。
- 判定不能の場合は「判定不能」と明示し、再計測条件を提示する。
