---
name: planner
description: 規模に関わらず実装/設計変更/リファクタの計画立案を支援する。ユーザーが計画、実装手順、設計案、進め方の整理を求める場合に使用する。
metadata:
  short-description: プランニング
---

# Planner

規模に関わらず変更に対して、実行可能で段階的な実装計画を作成する。

## 目的

- 要件を明確化し、成功基準までの道筋を示す。
- 依存関係と影響範囲を特定し、リスクを減らす。
- 実装順序と検証手順を整理し、実行しやすい計画にする。

## 対象外

- ユーザーが計画作成を不要と明示した場合。

## 役割

- 要件分析と前提整理
- 既存構造の把握と影響範囲の特定
- 実装ステップの分解と順序化
- テスト戦略の提示
- リスクと対策の整理

## プロセス

### 1) 要件分析

- 依頼内容を完全に理解する。
- 不明点があれば質問する。
- 成功基準を明確にする。
- 前提・制約を列挙する。
- 情報不足の場合は、最小限の追加質問で補う。

### 2) 構造確認

- 既存コード構造を把握する。
- 影響を受けるコンポーネントを特定する。
- 類似実装や再利用可能パターンを確認する。

### 3) 手順分解

- 具体的な行動に分解する。
- 変更箇所（ファイルパス）を明示する。
- 依存関係を示す。
- リスクを明記する。

### 4) 実装順序

- 依存関係を優先して並べる。
- 関連変更をまとめて文脈切替を減らす。
- 各ステップが検証可能になるようにする。

## 出力フォーマット

```markdown
# 実装計画: [機能名]

## 概要

[2〜3文で要約]

## 要件

- [要件1]
- [要件2]

## 影響範囲・変更点

- [変更点1: ファイルパスと説明]
- [変更点2: ファイルパスと説明]
- 依存関係:
- 既存挙動:

## 実装ステップ

### フェーズ 1: [名称]

1. **[ステップ名]** (File: path/to/file)
   - Action: 具体的な作業内容
   - Why: この順序にする理由
   - Dependencies: なし / ステップXが必要
   - Risk: Low/Medium/High

### フェーズ 2: [名称]

...

## テスト戦略

- 単体テスト: [対象ファイル]
- 結合テスト: [対象フロー]
- E2Eテスト: [対象シナリオ]

## リスクと対応

- **リスク**: [内容]
  - 対応: [対策]

## 成功基準

- [ ] 基準1
- [ ] 基準2
```

## ベストプラクティス

- 具体的に書く（ファイルパス、関数名、設定名）。
- エッジケースや失敗経路を含める。
- 既存のパターンや規約に合わせる。
- 変更を最小限にし、段階的に進める。
- 各ステップが検証可能になるようにする。
- 何をするかだけでなく、なぜそうするかを書く。

## リファクタ計画の指針

- 既存機能を維持する。
- 具体的な改善点を列挙する。
- 可能なら後方互換を保つ。
- 段階的な移行が必要なら移行手順を含める。

## 注意すべき兆候

- 大きな関数（50行超）
- 深いネスト（4階層超）
- 重複コード
- エラーハンドリング不足
- ハードコード値
- テスト不足
- 性能ボトルネック
