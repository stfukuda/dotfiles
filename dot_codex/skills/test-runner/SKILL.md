---
name: test-runner
description: テスト実行の計画・実行・結果整理・失敗時対応を提供する。ユーザーがテスト実行、テスト失敗の一次整理、テスト不可時の代替確認を求める場合に使用する。
metadata:
  short-description: テスト実行
---

# Test Runner

テストを安全に実行し、結果を短く整理する。

## 目的

- 実行可能なテストを適切な範囲で回す。
- 失敗時は再現性と原因に近い情報を残す。
- テスト不可の場合は代替確認を明示する。

## 対象外

- 軽微な変更でテスト実行が不要だと明示されている場合。

## 前提確認

- 実行すべきテスト種別（unit・integration・e2eなど）と優先順位を確認する。
- テスト対象の優先度判断基準（変更範囲・リスク・実行コスト）を確認する。
- 既存の規約（README・CONTRIBUTING・CI設定）があれば優先する。
- テストコマンド・フラグ・環境変数・必要な依存（DB・外部サービス）を確認する。
- 実行時間やリソース制約を確認する。
- 不明点は最小限の質問で補う。

## 手順

### 1) 実行範囲の決定

- 変更範囲に最も近いテストを優先する。
- 影響が広い場合は関連する上位テストを追加する。
- 優先順位の目安は「変更直結」→「境界/依存」→「重要経路」→「低コスト広範囲」とする。

### 2) 実行準備

- テスト前のセットアップ（依存起動・fixture・seed）を整理する。
- 破壊的な操作がある場合は事前に確認する。

### 3) テスト実行

- 既定のコマンドで実行し、必要なら最小限のフラグを追加する。
- 実行結果・ログ・失敗箇所を保存する。

### 4) 結果整理

- 合否・失敗テスト・再現手順を短くまとめる。
- 失敗が再現しない場合はその旨と試行内容を記録する。
- 再実行は同一条件で最小限に留め、回数と結果を記録する。

### 5) 失敗時の対応

- 失敗テスト名・エラーメッセージ・関連ログを整理する。
- 可能なら最小限の再現条件・原因候補・追加調査案を示す。
- 一時的なリトライやフレークの疑いがある場合は明示する。
- フレーク疑いの場合は再実行条件・回数・結果を明記する。

### 6) テスト不可時の代替確認

- テストできない理由を明記する。
- 代替確認（静的解析・ビルド・手動操作・ログ比較）を示す。

## 避けるべきこと

- テスト範囲の無根拠な縮小。
- 失敗結果の省略や要約しすぎ。
- 失敗原因の断定。
- 無制限の再実行で失敗を隠すこと。

## 出力フォーマット

```markdown
# テスト実行: [対象]

## 実行範囲

- テスト種別:
- 対象:

## 実行コマンド

- [コマンド]

## 実行結果

- 結果: 成功・失敗・未実行
- 失敗テスト:
- 主要ログ:
- 再実行:

## 失敗時の補足

- 再現性:
- 追加調査:
- 一時対応:
- フレーク疑い:

## テスト不可時

- 理由:
- 代替確認:
```

## 返答のガイド

- 実行したテストと結果を先に書く。
- 失敗時はテスト名と要点を簡潔に示す。
- 未実行の場合は理由と代替確認を必ず添える。
- 追加の確認が必要なら短く質問する。
